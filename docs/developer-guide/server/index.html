<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server - LMU Navigator</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> LMU Navigator</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
        <span>User-Guide</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../user-guide">Home</a>
                    
                </li>
            
        

    
        
        <span>Admin-Guide</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../admin-guide">Home</a>
                    
                </li>
            
        

    
        
        <span>Developer-Guide</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="..">Home</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../android">Android</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../ios">iOS</a>
                    
                </li>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Server</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#server-dokumentation">Server Dokumentation</a></li>
                            
                                <li><a class="toctree-l3" href="#installation">Installation</a></li>
                            
                                <li><a class="toctree-l3" href="#architektur">Architektur</a></li>
                            
                                <li><a class="toctree-l3" href="#datenbank">Datenbank</a></li>
                            
                                <li><a class="toctree-l3" href="#rest-api">REST API</a></li>
                            
                                <li><a class="toctree-l3" href="#deployment-des-servers">Deployment des Servers</a></li>
                            
                                <li><a class="toctree-l3" href="#room-canvas">Room Canvas</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#future-work">Future Work</a></li>
                            
                        
                        </ul>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../.."></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    <li>Server</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/lmu-navigator" class="icon icon-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h1 id="server-dokumentation">Server Dokumentation</h1>
<p><strong>Repository: </strong> https://github.com/lmu-navigator/server</p>
<p>Ausgangsbasis für den Server war die Praxisphase aus dem Praktikum <a href="http://www.mobile.ifi.uni-muenchen.de/studium_lehre/verg_semester/ws1314/msp/index.html">Mobile und Verteilte Systeme</a> im Wintersemester 2013/14. Dort haben wir einen RESTful Web Service mit Hilfe von Java, <a href="http://tomcat.apache.org/">Tomcat</a>, <a href="https://jersey.java.net/">Jersey</a> (JAX-RS) und <a href="http://www.mysql.com/">MySQL</a> aufgesetzt, hier die <a href="http://www.mobile.ifi.uni-muenchen.de/studium_lehre/verg_semester/ws1314/msp/05-rest.pdf">Folien zur damaligen Übung</a>.</p>
<p><strong>Übersicht:</strong>
<em> Installation
</em> Architektur (Struktur)
<em> REST API
</em> Deployment</p>
<h2 id="installation">Installation</h2>
<p>Installation der Arbeitsumgebung, welche von 2013 bis Anfang 2015 verwendet wurde.</p>
<ul>
<li>Tomcat</li>
<li>MySQL</li>
<li>Apache</li>
<li>Eclipse</li>
</ul>
<h3 id="tomcat">Tomcat</h3>
<ul>
<li>Tomcat Version: 7.0.42.0</li>
<li>JVM Version: 1.7.0_21-b11</li>
<li>OS Name: Windows 8, Version: 6.2, Architecture: amd64</li>
</ul>
<h3 id="mysql">MySQL</h3>
<p>Beim MySQL Server (Version 5.0.11) wurden keine individuellen Anpassungen vorgenommen. Wir haben lokal mit der MySQL-Instanz gearbeitet, welche mit <a href="https://www.apachefriends.org/de/index.html">XAMPP</a> mitgeliefert wurde.</p>
<p>Als Administrationsoberfläche haben wir <a href="http://www.phpmyadmin.net/">PhpMyAdmin</a> verwendet, welches ebenfalls mit XAMPP mitgeliefert wird.</p>
<h3 id="apache">Apache</h3>
<p><a href="http://httpd.apache.org/">Apache</a> haben wir für PhpMyAdmin und zum Hosten von allen statischen Dateien (über Port 80) verwendet, da ein Tomcat Servlet mit mehreren 100 MB auf Windows zu Problemen und Abstürzen führt.</p>
<h3 id="xampp">XAMPP</h3>
<p>Die Installation von <a href="https://www.apachefriends.org/de/index.html">XAMPP</a> ist optional. Sie erleichtert vor allem bei Windows Geräten die Installation von Apache, PHP, MySQL und PhpMyAdmin.</p>
<h3 id="eclipse">Eclipse</h3>
<p><a href="https://eclipse.org/downloads/">Eclipse Java EE</a> IDE for Web Developers<br> (Juno Service Release 2, Build id: 20130225-0426)
)</p>
<p>Benötigte Plugins: <a href="http://www.eclipse.org/webtools/">Eclipse Web Tools Platform</a></p>
<p>Import des Projektes</p>
<ul>
<li>
<p>GitHub Repo klonen</p>
</li>
<li>
<p>Eclipse installieren (Version siehe oben)</p>
</li>
<li>
<p>Projekt importieren
<img alt="" src="../../images/server/installation-1.png" /></p>
</li>
<li>
<p>General &gt; Existing Projects into Workspace
<img alt="" src="../../images/server/installation-2.png" /></p>
</li>
<li>
<p>Projekt hinzufügen
<img alt="" src="../../images/server/installation-3.png" /></p>
</li>
</ul>
<p><strong>Konfiguration von Eclipse</strong></p>
<p>Sollte es zu Problemen bei dem Ausführen des Servlets kommen, kann es u.a. daran liegen, dass Eclipse das Projekt noch nicht als Dynamic Web Project erkennt. Hierfür müssen u.a. folgende Projekt-Einstellungen vorgenommen sein:</p>
<ul>
<li>
<p>Java Version 1.6, da auf dem aktuellen Server (http://141.84.213.246:8080) nur Java 1.6 installiert ist.
<img alt="" src="../../images/server/konfiguration-1.png" /></p>
</li>
<li>
<p>Sicherstellen, dass die Facets <em>Dynamic Web Module</em> und <em>JAXB</em> ausgewählt sind.
<img alt="" src="../../images/server/konfiguration-3.png" /></p>
</li>
<li>
<p>Und hier noch eine Übersicht der verwendeten JARs
<img alt="" src="../../images/server/konfiguration-2.png" /></p>
</li>
<li>
<p>Sicherstellen, dass Tomcat auch als Runtime Environment zu Eclipse hinzugefügt wurde.
<img alt="" src="../../images/server/konfiguration-2.png" /></p>
</li>
</ul>
<h2 id="architektur">Architektur</h2>
<ul>
<li>Erklärung des Datenmodells</li>
<li>Erklärung der Module</li>
<li>Wie die Module und Klassen zusammenhängen</li>
<li>Wie man auf den Server zugreifen kann</li>
</ul>
<h3 id="modell">Modell</h3>
<p>Das Modell ist im Package <code>de.lmu.navigator.server.model</code> abgelegt. Für uns wichtig sind folgende Klassen: (mit Mapping von unserem Datenmodell zu den CSV-Dateien von der LMU)</p>
<pre><code>City.java            &lt;-&gt;    01_Stadt.csv
Street.java          &lt;-&gt;    02_Strasse.csv
Building.java        &lt;-&gt;    03_Bauwerk.csv
BuildingPart.java    &lt;-&gt;    04_BauteilHaus.csv
Floor.java           &lt;-&gt;    05_Geschoss.csv
Room.java            &lt;-&gt;    06_Raum.csv
</code></pre>
<p>Zwischen den jeweiligen Modell-Hierarchien besteht eine 1-zu-N-Beziehung (von City zu Street, von Street zu Building, usw).</p>
<h3 id="packages">Packages</h3>
<p>Der Java Tomcat-Server besteht aus folgenden fünf Packages:</p>
<pre><code>de.lmu.navigator.server           (REST API / Jersey)
de.lmu.navigator.server.data      (Logik für Raumpositionierung)
de.lmu.navigator.server.database  (MySQL Integration)
de.lmu.navigator.server.model     (Datenmodell)
de.lmu.navigator.server.upload    (CSV Importer)
</code></pre>
<h4 id="modell-package">Modell-Package</h4>
<p>Das gerade beschriebene Datenmodell liegt im Package <code>de.lmu.navigator.server.model</code> vor. Dort liegen neben den oben beschriebenen Objekttypen noch ein paar weitere Klassen bereit:</p>
<pre><code>Settings.java                 (Pfade wo PNGs/PDFs im Dateisystem liegen)
Version.java                  (Fortlaufende Numerierung für Versionskontrolle)
</code></pre>
<p>Zum Zeitpunkt des Praktikums haben wir auch noch <strong>Wegegraphen</strong> für das Indoor-Routing gespeichert, welcher in der aktuellen Version der App und des Servers gestrichen wurde. Für diesen Wegegraphen hatten wir folgende Klassen angelegt:</p>
<pre><code>RoutingNode.java              (Knoten)
RoutingEdge.java              (Kante)
RoutingFloorConnection.java   (Verbindet stockwerkübergreifend Knoten)
RoutingRoomConnection.java    (Verbindet Räume mit Knoten)
</code></pre>
<h4 id="hauptmodul">Hauptmodul</h4>
<p>Das Hauptmodul <code>de.lmu.navigator.server</code> definiert die REST API und stellt somit den Entry Point für die Server-Anwendung dar. Umgesetzt wurde dieser Teil mit der <a href="https://jax-rs-spec.java.net/">Java API for RESTful Services (JAX-RS)</a> (Package javax.ws.rs). Für nähere Informationen zu Jersey (JAX-RS) siehe: https://jersey.java.net/documentation/latest/index.html</p>
<p>Das Mapping von REST URI zu den Getter und Setter Funktionen funktioniert recht intuitiv über Annotationen direkt im Code. An der Klasse selbst legt man fest, welches</p>
<pre><code class="java">@Path(&quot;/rooms&quot;)
public class Rooms {

  @GET
  @Produces(&quot;application/json&quot;)
  public ArrayList&lt;Room&gt; getRoomsByRange(
    @DefaultValue(&quot;&quot;) @QueryParam(&quot;code&quot;) String roomCode,
    @DefaultValue(&quot;&quot;) @QueryParam(&quot;floor&quot;) String floorCode)
    throws Exception {
      ...
  }
}

</code></pre>

<p>Für die Klassen XX bis XX ist der Aufbau analog.</p>
<p>Als Datenbank-Anbindung haben wir jeweils die Klassen CityMySQL - RoomMySQL angelegt.</p>
<h2 id="datenbank">Datenbank</h2>
<p>Als Datenbank haben wir uns für <a href="../../mysql.com">MySQL</a> und als Administrationsoberfläche für <a href="http://www.phpmyadmin.net/">PhpMyAdmin</a> entschieden, da hierfür die meisten Vorkenntnisse vorhanden waren.</p>
<p>Die Architektur der Datenbank ist angelehnt an die Struktur der CSV-Dateien, welche wir für den Import vom <a href="http://www.uni-muenchen.de/einrichtungen/zuv/uebersicht/dez_iv/ref_iv1/index.html">Referat IV.1</a> der LMU München bekommen.</p>
<p>Ein vollständiger MySQL-Dump der Datenbank kann im privaten GitHub-Repository gefunden werden: https://github.com/lmu-navigator/data/tree/master/sql</p>
<p>Zur Veranschaulichung findet ihr hier die Struktur der MySQL Tabellen (Stand Februar 2015). Der aktuelle Stand wird</p>
<!--

wzxhzdk:1



Folgende Tabellen sind optional. Diese Tabellen waren für die Indoor-Routing Funktionalität unseres Prototypen benötigt.


wzxhzdk:2

-->

<h2 id="rest-api">REST API</h2>
<p>Im folgenden wird die REST Schnittstelle des Tomcat Servers beschrieben. Aktuell kann die REST-API für den Server unter folgender Adresse aufgerufen werden: http://141.84.213.246:8080/lmu-navigator/rest/</p>
<p>Für den Produktiveinsatz arbeiten wir vorerst mit statischen JSON-Dateien. Zum einen da sich der Datenbestand meist nur einmal pro Semester verändert, zum anderen da wir dadurch auf Server der LMU München zurückgreifen können. Die neu generierten JSON-Dateien werden bei jeder Verändernug (Veränderung der Versionsnummer <code>/rest/version</code>) erneut am Mobilgerät eingelesen. Die Aktualisierung ist einmal pro Semester in Rücksprache mit den Referaten geplant.</p>
<p>Nützliche Links für die Entwicklung:
<em> http://stackoverflow.com/q/630453/1402076 (PUT vs POST)
</em> http://goo.gl/C3FPyt (Advanced Rest Client / Chrome Plugin)</p>
<h3 id="statische-json-dateien">Statische JSON Dateien</h3>
<p>Alle für die App relevanten Raum- und Gebäudedaten liegen auf folgendem Server der LMU vor:</p>
<pre><code>TODO StaticServer URI
</code></pre>
<p>asdf</p>
<pre><code>1_city.json
2_street.json
3_building.json
3_building_position.json
4_building_part.json
5_floor.json
6_room.json
version.json
</code></pre>
<p>Hier werden neben den JSON Dateien auch die Gebäudepläne im PNG- und PDF-Format gehosted. Ansprechpartner für diesen Server ist das <a href="http://www.internetdienste.verwaltung.uni-muenchen.de/funktionen/kontakt/index.html">Referat für Internetdienste</a>.</p>
<h3 id="rest-funktionalitat-des-tomcat-servers">REST Funktionalität des Tomcat Servers</h3>
<p><strong>GET /version</strong>
* liefert die aktuelle Version der Datenbasis<br>
  {"version":7,"timestamp":1409688383}</p>
<h4 id="cities">/cities</h4>
<ul>
<li><strong>GET /cities</strong>
  returns a list of all cities with LMU buildings</li>
</ul>
<h4 id="streets">/streets</h4>
<h4 id="buildings">/buildings</h4>
<h4 id="buildingparts">/buildingparts</h4>
<h4 id="floors">/floors</h4>
<ul>
<li>
<p><strong>GET /floors/{floorCode}</strong>
  returns a single floor for the requested floor ID / code</p>
</li>
<li>
<p><strong>GET /floors/{floorCode}/bordering</strong>
  returns all floors associated to the same mapUri (PDF file), excluding the floor itself, required for buildings like the main building (Geschwister-Scholl-Platz)</p>
</li>
<li>
<p><strong>GET /floors</strong>
  returns all available floors from the database</p>
</li>
<li>
<p><strong>GET /floors?code={floorCode}&amp;buildingpart={buildingPartCode}</strong>
  returns all available floors from the database</p>
</li>
</ul>
<h4 id="rooms">/rooms</h4>
<p><strong>Besonderheiten:</strong> Es werden nur Räume als JSON ausgegeben, die eine gültige Position haben (PosX != 0 + PosY != 0) und sichtbar sind (hidden == 0). Nicht positionierte und deaktivierte Räume werden somit nicht zur App übertragen.</p>
<h2 id="deployment-des-servers">Deployment des Servers</h2>
<p>Schritt für Schritt-Anleitung:</p>
<ul>
<li>
<p>Zuerst in <code>de.lmu.navigator.server.database.Database.java</code> die Flag <code>PRODUCTION_SERVER</code> auf <code>true</code> setzen, und nach dem Exportieren der WAR file wieder zurück auf <code>false</code> (=development environment).</p>
</li>
<li>
<p>Eclipse-Projekt als WAR-File exportieren
<img alt="" src="../../images/server/deployment-1.png" /></p>
</li>
<li>
<p>WinSCP starten und am Server einloggen</p>
</li>
<li>
<p>Die WAR-Datei hochladen und nun folgende Kommandos ausführen</p>
<p>sudo rm webapps/lmu-navigator.war
sudo rm webapps/lmu-navigator/ -r
sudo mv lmu-navigator.war webapps/</p>
</li>
</ul>
<p>Der Pfad für <code>webapps</code> variiert von System zu System. Auf dem aktuellen System weist er auf <code>/var/lib/tomcat7/webapps</code>.</p>
<p>Bei Problemen mit Tomcat auf dem <a href="http://141.84.213.246:8080/">141.84.213.246</a>-Server am besten mal in das <a href="https://gitlab.cip.ifi.lmu.de/zieglerl/lmu-navigator/wikis/tomcat-server">GitLab-Wiki</a> schauen.</p>
<h2 id="room-canvas">Room Canvas</h2>
<p>Manually updating the room positions of on the RoomsOverview servlet, e.g.: http://localhost:8080/lmu-navigator/data/rooms?floor=g650301</p>
<p>Features:
<em> Manual positioning of rooms cross iFrames
</em> Press the ESC key to abort the manual positioning and scroll back to top
<em> Right click: Pan
</em> Left click: select new position</p>
<h1 id="future-work">Future Work</h1>
<p>Auf den MEAN-Stack migrieren, Node.js für das Backend verwenden und Angular.js, Ember.js oder Backbone.js für das Frontend.</p>

            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../ios" class="btn btn-neutral" title="iOS"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
            <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
        
      <span><a href="../ios" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>